# 指令系统

游戏里面有独立的指令系统是一件很正常的事情，比如《cs2》和《Minecraft》。同样的，星落也有一个独特的指令系统。

## 栈

在做这个之前，我还没学编译原理（

让我们设想一个堆叠结构：**栈**。假设这是一个装积木的盒子，每一个积木都占据单独的一层，你只能从顶部拿出或放入积木。它遵循**后进先出**原则，即“后放入的积木总会先被拿出来”。

假设左边是盒子底部，右边是盒子顶部，我们按顺序放置以下积木：  
#`-add`,`2`,`-mul`,`4`,`3`#

这就是一条指令的样子。  
其中，`-add`和`-mul`分别为加和、乘积运算，都接收两个参数。那么，分析器的操作是这样的：

指令盒子|暂存盒子|操作
---|---|---
`-add`, `2`, `-mul`, `4`, `3`|-|从后向前读一个，并放入暂存盒子
`-add`, `2`, `-mul`, `4`|`3`|并非指令，再读
`-add`, `2`, `-mul` |`3`, `4`|并非指令，再读
`-add`, `2`, |`3`, `4`|拿到乘积指令`-mul`，从暂存盒子中取两个数计算
`-add`, `2`, |`12`|得到数值`12`，放回暂存盒子
`-add` |`12`, `2`|`2`并非指令，再读
-|`12`, `2`|拿到加和指令`-add`，从暂存盒子中取两个数计算
-|`14`|得到数值14，放回暂存盒子
-|`14`|指令盒子为空，返回暂存盒子的数

最后就得到了指令运行的结果`14`。